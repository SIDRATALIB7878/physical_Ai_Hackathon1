# RAG Agent with OpenAI and Qdrant Integration

This module implements a Retrieval-Augmented Generation (RAG) agent using OpenAI's API and Qdrant vector database for querying book content.

## Components

### 1. Retrieval Tool (`retrieval_tool.py`)
- Queries Qdrant vector database to find relevant book content
- Uses existing embedding generation and storage infrastructure
- Formats results for use in the RAG agent

### 2. RAG Agent (`rag_agent.py`)
- Implements an OpenAI-based agent that uses retrieval-augmented generation
- Two implementations provided:
  - Full OpenAI Assistant API implementation
  - Simpler implementation that retrieves content first, then generates response

### 3. Mock Retrieval Tool (`mock_retrieval_tool.py`)
- Provides mock data for testing without a Qdrant connection
- Simulates retrieval results based on query content

## Architecture

```
User Query
    ↓
Query Embedding (using Cohere)
    ↓
Vector Search in Qdrant
    ↓
Relevant Content Retrieved
    ↓
Context Formatted for OpenAI
    ↓
Response Generated by OpenAI
    ↓
Answer Returned to User
```

## Setup

1. Install dependencies:
```bash
pip install -r requirements.txt
```

2. Set up environment variables in `.env`:
```env
OPENAI_API_KEY=your_openai_api_key
COHERE_API_KEY=your_cohere_api_key
QDRANT_API_KEY=your_qdrant_api_key
QDRANT_URL=your_qdrant_cluster_url
```

3. Ensure Qdrant vector database has book content embeddings stored from the book embedding pipeline.

## Usage

### Basic Usage
```python
from backend.rag_agent.rag_agent import RAGAgentSimple

# Create the agent
agent = RAGAgentSimple()

# Ask a question
question = "What is the main concept of artificial intelligence?"
response = agent.ask(question, book_id="your_book_id", limit=5)
print(response)
```

### With Retrieval Tool Only
```python
from backend.rag_agent.retrieval_tool import retrieve_book_content

# Retrieve relevant content directly
results = retrieve_book_content("query text", book_id="your_book_id", limit=5)
print(results)
```

## Testing

### With Mock Data (No Qdrant Required)
```bash
cd backend
python -m rag_agent.test_mock_agent
```

### Full Test (Requires Qdrant and OpenAI API)
```bash
cd backend
python -m rag_agent.test_agent
```

## Key Features

1. **Modular Design**: Separation of retrieval and generation components
2. **Reusability**: Leverages existing embedding and storage infrastructure
3. **Error Handling**: Graceful degradation when services are unavailable
4. **Extensibility**: Easy to add new retrieval methods or modify generation logic

## Constraints & Limitations

- Requires OpenAI API key for generation
- Requires Qdrant connection for retrieval
- Depends on existing book embeddings in Qdrant
- Python 3.14 compatibility issues with some libraries

## Future Enhancements

- Add support for conversation history
- Implement caching for frequently accessed content
- Add support for multiple books in a single query
- Enhance error handling and retry logic
- Add monitoring and logging capabilities